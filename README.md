# lambda-github-release-hook-example

Serverless Lambda that gets a Github release event and trigger a AWS pipeline

## How it works

Using serverless framework this project will setup a API Gateway and Lambda function. Using GitHub webhooks we will trigger 
the endpoint and if the event is a release event it will trigger a AWS Codepipeline

## How to get it working:

* Checkout this repo and copy content into new directory

* Setup aws-cli: [AWS CLI DOCS](http://docs.aws.amazon.com/lambda/latest/dg/setup-awscli.html)

* Install Yarn [YARN INSTALLATION](https://yarnpkg.com/lang/en/docs/install/)
  - NPM can be used as well
  
* Install serverless globally
  - `yarn global add serverless` or `npm install -g serverless`

* Install project dependencies
  - `yarn install` or `npm install`
  
* Configure serverless.yml
  - Setup PIPELINE_NAME
  - Setup Secret ***DO NOT COMMIT SECRET TO REPO*** unless encrypted. Encryption can be done using a plugin like serverless-plugin-secrets
    - Secret can be generated by: `ruby -rsecurerandom -e 'puts SecureRandom.hex(20)'` in terminal. (From GitHub site)

* Deploy API Gateway and AWS Lambda
  - Run `serverless deploy` (-v can be used to get a detailed progress report)
  
* Setup GitHub Webhook for repo:
  - Go to repo -> settings -> webhooks
  - Create a new Webhook
  - You can use either *Send Everything* or *Let me select individual events* (This is recommended so it does not trigger on every event in github)
  - Get Secret from above and paste into the secret field
  - Get Endpoint from API Gateway and paste into Payload URL field
  
 Everything should now be setup. You can run a test trigger or publish a release. If successful in Github Webhooks under your
 created webhook there should `200` and a response of *Success*. If a `200` and a *Not a release event* is specified it just means
 it worked but the event was not a release event.
